branches:
  only:
  - scriptable
os: osx
osx_image: xcode13.4
language: node_js
node_js:
- 10
addons:
  ssh_known_hosts: github.com
  homebrew:
    packages:
    - vitorgalvao/tiny-scripts/cask-repair
    update: true
env:
  global:
  - IS_RELEASE=$(if [ "$TRAVIS_BRANCH" = "scriptable" -a "$TRAVIS_PULL_REQUEST" = "false"
    ]; then echo true; fi)
  - XCODE_BUILD_PATH="DerivedData/Build/Products/Release"
  - VERSION_FILE="VERSION.txt"
  - APP_NAME="$(awk -F ' = ' '/PRODUCT_NAME/ { print $2; }' < config/base.xcconfig)"
install: true
script: scripts/travis.sh
before_deploy: if [[ $TRAVIS_TEST_RESULT == 1 ]]; then echo "build failed; exiting
  to prevent deploy phases"; sleep 2; exit 1; fi
deploy:
  provider: releases
  token:
    secure: NzUMOo+lsh6X8EXv83VQI5QjeQ5ldLoZSJ6qGMQGNhapTE2OFAiySYQOergUdPrig5UxaZStyoUYvWrEQMK597Q8fbxMiT0O4120Mzzay6kpxJpiES2VVkpVR5GAoqjCk/fuFGehBxhPt8hyVHdKtH5yo0amNEryfo6Xok7rwwiZE+1U05uO9NqL8PORLYdqIU0Aj3rQRX5IeO72XVYpaCyUE6C8VVARCYUj53+TT8LV2MqsGmGJq0irPAVABvYCfH6Mq7XgMsjqcdBeJk4RoRvj9WXsx0LvjUs164PgfJqw70GYt6xXI1+nD2DgpZbWM7t6EKYWWjpW7NRZ7AHcXTZCCD7ryxMUpR7Rdi0hFpQY+lbjrKqGMSUqZH2NPzTiLRhT8UY7O5tyYgrWv7kodvTo2HQz0kBv+wBdGD4xF5RbPHYZHNHWtsmIwGRBhHKzacY2h1a3aU5rnvq/ksuOBOrLEtwCsjvew7K1jkTscnyRvWEPRwNdvujvn+YmRQKb3Qo93mDcxvc+9BuZhVGQUC8LhPJSR3hqsspUh1d0s9AJdqtKswAXZFXDvT/7jjU16nChaR9Yf0tyv2VPU4T7v1WbNcJekBvH8qRaBDqtUdansZ3algxdXSWk7dFf2lotKrefer994zMxcljzfahDbiu421g1N9lqbkFakANKE4c=
  file_glob: true
  file: "$XCODE_BUILD_PATH/*.zip"
  skip_cleanup: true
  on:
    repo: steventheworker/alt-tab-macos
after_deploy: scripts/update_homebrew_cask.sh
before_install:
- openssl aes-256-cbc -K $encrypted_9d3155e86c77_key -iv $encrypted_9d3155e86c77_iv
  -in AppleDevCert.p12.enc -out ~\/.ssh/keychain\ copies/AppleDevCert.p12 -d
- openssl aes-256-cbc -K $encrypted_b749442190b9_key -iv $encrypted_b749442190b9_iv
  -in ed25519_sparkle_account_private_key.enc -out ~\/.ssh/keychain\ copies/ed25519_sparkle_account_private_key
  -d
